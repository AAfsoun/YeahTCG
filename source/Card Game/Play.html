
<style>

/* general styles */ 

body {
	
	/* optional. Consider removing this later. */
	user-select: none; /* supported by Chrome and Opera */
   -webkit-user-select: none; /* Safari */
   -khtml-user-select: none; /* Konqueror HTML */
   -moz-user-select: none; /* Firefox */
   -ms-user-select: none; /* Internet Explorer/Edge */
}


button {
  display: inline-block;
  background-color: #629D62;
  border: none;
  border-radius: 1vh;
  color: white;
  text-align: center;
  text-decoration: none;
  padding: 1vh 2vh;
  font-size: 2vh;
  
  transition: all 0.1s;
}

button:hover {
  background-color: #B0D8B0;
  color: #424242;
}







/* Control Div Stuff */


div.control {
	position: static;
	margin-top: 8vh;
	margin-left: 8vw;
	margin-right: 8vw;
	transition: all 0.2s;
}

div.control div.subControl {
	position: static;
	width: 100%;
	
	overflow-x: auto;
	overflow-y: hidden;
	white-space: nowrap;
	
}

div.control p.label{
	position: absolute;
	float: left;
	margin-top: 8vh;
	padding: 1vh;
	font-size: 8vh;
	transform: rotate(65deg);
	z-index: 3;
	
	pointer-events: none;
	
	
	background-color: #DFA5A5;
	border: 4px solid black;
	border-radius: 20px;
	color: #000000;
	
	user-select: none; /* supported by Chrome and Opera */
   -webkit-user-select: none; /* Safari */
   -khtml-user-select: none; /* Konqueror HTML */
   -moz-user-select: none; /* Firefox */
   -ms-user-select: none; /* Internet Explorer/Edge */
   
}

div {
	//background-color: grey;
}

div.control div#chooseText {
	//background-color: red;
	font-size: 8vh;
	position: absolute;
	height: 70vh;
	left: 0;
	right: 0;
	
	overflow-x: hidden;
	overflow-y: auto;
	white-space: nowrap;
	cursor: pointer;
}

div.control div#chooseText p {
	transition: all 0.2s;
	background-color: #A5A5DF;
}

div.control div#chooseText p:hover {
	background-color: #A5DFA5;
}

div.control div#chooseText p.selected {
	background-color: #DFA5A5;
}

div#opponentCards {
	display:none;
}




div#controlText {
	position: fixed;
	z-index: 4;
	top: 40px;
	height: 8vh;
	left: 0;
	right: 0;
	text-align: center;
	
	
	transition: all 0.2s;
	pointer-events: none;
}

div#controlText p {
	font-size: 6vh;
	background-color: #A5A5DF;
	border: 4px solid black;
	border-radius: 20px;
	color: #000000;
	
	position :fixed;
	left: 10vw;
	right: 10vw;
	
	user-select: none; /* supported by Chrome and Opera */
   -webkit-user-select: none; /* Safari */
   -khtml-user-select: none; /* Konqueror HTML */
   -moz-user-select: none; /* Firefox */
   -ms-user-select: none; /* Internet Explorer/Edge */
}

button#submitButton {
	position: fixed;
	bottom: 8vh;
	right: 8vw;
	transition: all 0.2s;
}

button#hideOpponentCardButton {
	position: fixed;
	bottom: 8vh;
	left: 16vw;
}









/* Background Div Stuff */
div.sidebar {
	position: fixed;
	
	
	width: 4vh;
	height: 32vh;
	
	
	transition: all 0.3s;
}

div.sidebar:hover {
	width: 16vh;
	height: 40vh;
	overflow: visible;
}


div.topbar {
	position: fixed;
	
	
	left: 16vw;
	right: 16vw;
	height: 4vh;
	
	overflow-x: auto;
	overflow-y: hidden;
	
	white-space: nowrap;
	
	transition: all 0.3s;
}

div.topbar:hover {
	height: 20vh;
}

div.midbar {
	position: fixed;
	
	
	left: 16vw;
	right: 16vw;
	height: 20vh;
	
	
	white-space: nowrap;
	
	overflow-x: auto;
	overflow-y: hidden;
}
	


div.bottomLeft {
	bottom: 0;
	left: 0;
	direction: rtl;
}

div.bottomRight {
	bottom: 0;
	right: 0;
}

div.topLeft {
	top: 40px;
	left: 0;
	/*transform: scale(-1);*/
	direction: rtl;
}

div.topRight {
	top: 40px;
	right: 0;
	/*transform: scale(-1);
	direction: rtl; */
}

div.bottom {
	bottom: 0;
}

div.top {
	top: 40px;
}

div.midLeft {
	left: 3vh;
	bottom: 40vh;
}

div.midRight {
	right: 3vh;
	top: 40vh;
	/*transform: scale(-1);*/
}

div.topMid {
	margin-top: 40px;
	top: 20vh;
	/*transform: scale(-1);*/
}

div.bottomMid {
	bottom: 20vh;
}


div.sidebar > div {
	height: 50%;
	overflow-y: auto;
	overflow-x: hidden;
}

div.sidebar > div > div {
	height: 93%;
}

div.topbar > div {
	height: 20vh;
}

div#mainBackgroundDiv div#counterDivs {
	opacity: 0;
}

div#mainBackgroundDiv div.counterDiv {
	position: fixed;
	padding: 1vh;
	font-size: 2vh;
	z-index: 10;
	
	pointer-events: none;
	
	
	background-color: #A5DFDF;
	border: 2px solid black;
	border-radius: 10px;
	color: #000000;
	
	user-select: none; /* supported by Chrome and Opera */
   -webkit-user-select: none; /* Safari */
   -khtml-user-select: none; /* Konqueror HTML */
   -moz-user-select: none; /* Firefox */
   -ms-user-select: none; /* Internet Explorer/Edge */
} 





/* disp stuff */

.dispDiv {
	height: 100%;
	display: inline-block;
	transition: all 0.2s;
	cursor: pointer;
}

.dispDiv:hover {
	transform: scale(1.1);
	z-index: 10;
}

.dispDiv p {
	
	position: absolute;
	left: 0;
	right: 0;
	top: 20%;
	font-size: 80px;
	z-index: 1;
	
	background-color: #A5DFA5;
	border: 4px solid black;
	border-radius: 20px;
	color: #000000;
	
	user-select: none; /* supported by Chrome and Opera */
   -webkit-user-select: none; /* Safari */
   -khtml-user-select: none; /* Konqueror HTML */
   -moz-user-select: none; /* Firefox */
   -ms-user-select: none; /* Internet Explorer/Edge */
   
   
	opacity: 0%;
	transition: all 0.3s;
}

.dispDiv p.counter {
	
	left: 50%;
	width: 3vh;
	font-size: 3vh;

	border: none;
	border-radius: 100%;
	opacity: 100%;
}

.dispDiv p.dispCounter {
	left:50%;
	width: 20vh;
	font-size: 20vh;
}

.dispCard {
	width: auto;
	height: 100%;
	
	transition: all 0.3s;
}

.selected {
}

.selected img {
	opacity: 50%;
}

.selected p {
	opacity: 100%;
}

.uninteractable {
	pointer-events: none;
	opacity: 0;
}


div#mainDisplayDiv {
	z-index: 11;
	position: fixed;
	left: 0;
	right:0;
	top: 40px;
	bottom: 0;
	
	
	overflow-x: auto;
	overflow-y: hidden;
	white-space: nowrap;
	
	/*
	display: flex;
	flex-direction: row;
	align-items: center;
	justify-content: center;*/
	
	pointer-events: none;
	opacity: 0;
}

div#mainDisplayDiv > p {
	font-size: 20vh;
	background-color: #D98585;
	border: 8px solid black;
	border-radius: 8vh;
	white-space: normal;
}

button#hideControlButton {
	position: fixed;
	bottom: 8vh;
	left: 8vw;
}









/* animations */

.slidein {
	left: 2000px;
	animation-name: slidein;
	animation-duration: 0.5s;
	animation-delay: 0.2s;
	animation-fill-mode: forwards;
	position: relative;
}

.fadein {
	opacity: 0%;
	animation-name: fadein;
	animation-duration: 0.5s;
	animation-delay: 0.3s;
	animation-fill-mode: forwards;
}

.fadeinthenout {
	opacity: 0%;
	animation-name: fadeinthenout;
	animation-duration: 3s;
	animation-delay: 0.5s;
	animation-fill-mode: forwards;
}


@keyframes slidein {
	0%   {left: 2000px;}
	100% {left: 0;}
}

@keyframes fadein {
	0%	 {opacity: 0%;}
	100% {opacity: 100%;}
}

@keyframes fadeinthenout {
	0%	 {opacity: 0%;}
	20%  {opacity: 100%;}
	80%  {opacity: 100%;}
	100% {opacity: 30%;}
}



</style>
	
	<div id="deckformdiv" style="visibility: visible;">
		<form name="cardForm" autocomplete="off" onsubmit="deckreq();return false;">
		<p>Deck Name</p><input type="text" name="deckName">
		<input type="submit" value="submit">
		</form>
	</div>
	
	<div id="gamediv" style="visibility: hidden">
	
		<div id="mainBackgroundDiv">
			<div class="bottomLeft sidebar"><div id="player1"></div><div id="player2"></div></div>
			<div class="bottomRight sidebar"><div id="player3"></div><div id="player4"></div></div>
			<div class="bottom topbar" id="player5"></div>
			<div class="bottomMid midbar" id="player6"></div>
			<div class="topLeft sidebar"><div id="opponent4"></div><div id="opponent3"></div></div>
			<div class="topRight sidebar"><div id="opponent2"></div><div id="opponent1"></div></div>
			<div class="top topbar" id="opponent5"></div>
			<div class="topMid midbar" id="opponent6"></div>
			<div id="counterDivs">
				<div class="midLeft counterDiv">you<p id="playerHealth">health: 40</p><p id="playerBreath">breath: 3</p></div>
				<div class="midRight counterDiv">opponent<p id="opponentHealth">health: 40</p><p id="opponentBreath">breath: 3</p></div>
			</div>
		</div>
		
		
		<div id="mainControlDiv">
			<div id="controlText"></div>
			<div id="control" class="control">
			</div>
			<div id="opponentCards" class="control"></div>
			<button id="hideOpponentCardButton" class="uninteractable" onclick="cycleControl();return false;">show opponent cards</button>
			<button id="submitButton" class="uninteractable" onclick="resGetCards();return false;">submit</button>
		</div>
		
		

		<button id="hideControlButton" onclick="toggleControl(this);return false;">hide control</button>
		
		
		<div id="mainDisplayDiv"></div>
	
	</div>
	
	
	<script src = "/socket.io/socket.io.js"></script>
	<script src = "/data/scripts/cardGame/CardObjects.js"></script>
	<script src = "/data/scripts/cardGame/GameUtils.js"></script>
	<script>
	
		// communication init
		const socket = io("/cardgame");
		const carddisplaysocket = io("/cards");
		
		socket.on('ding', function(data){
			socket.emit("dong", {beat: 1});});
		
		// player connection+setup stuff
		
		carddisplaysocket.on("resAllStockCards", resAllCards);

		socket.on("beginGame", beginGame);
		socket.on("endGame", endGame);
		socket.on("serverReqChooseCards", getCards);
		socket.on("serverReqChooseText", getText);
		socket.on("updateCollection", updateCollection);
		socket.on("updateCounters", updateCounters);
		socket.on("dispCards", dispCards);
		
		
		
		
		
		
		
		// socket stuff
		function resAllCards(data) {
			console.log("in resAllCards");
			for(let card of data) {
				cards[card.name] = Card([], 0, 0, card.name, card.cost, card.img, card.move, card.txtcolor, card.cardType, card.cardAction);
			}
		}
		
		
		function beginGame(data) {
			console.log('in beginGame', data);
			/*for(let card of data['hand']) {
				dispBGCard(card, playerHand);
			}
			for(let card of data['activeGoals']) {
				dispBGCard(card, playerActiveGoals);
			}*/
			
			dispBGCard('cardBack', playerDeck);
			dispBGCard('cardBack', playerGoals);
			dispBGCard('cardBack', opponentDeck);
			dispBGCard('cardBack', opponentGoals);
			clearMainDisplay();
			
			counterDiv.classList.add('fadein');
		}
		
		function endGame(data) {
			console.log('in endGame');
			
			for(let container of [playerPlay, playerHand, playerActiveGoals, opponentPlay, opponentHand, opponentActiveGoals]) {
				while(container.firstChild) {
					removeBGCard(0, container);
				}
			}
			clearControl();
			dispText(data['msg']);
		}
		
		function getCards(data) {
			
			authToken = data['authToken'];
			delete data['authToken'];
			
			if(messageId==data['msgId']) {
				return;
			}
			messageId = data['msgId'];
			delete data['msgId'];
			let msg = data['msg'];
			delete data['msg'];
			
			clearControl();
			
			
			
			
			const p = document.createElement("p");
			p.innerHTML = msg;
			p.classList.add("fadein");
			controlTextDiv.appendChild(p);
			
			controlSubmitButton.classList.remove("uninteractable");
			hideOpponentCardButton.classList.remove("uninteractable");
			
			
			
			for(let name in data) {
				makeNewControlArea(name, controlDiv, control, controlNames);
			}
			for(let area of control) {
				area.style.height = (70/control.length)+"vh";
				area.firstChild.style.fontSize = (16/control.length)+"vh";
			}
			for(let i=0; i<controlNames.length; ++i) {
				for(let cindex=0; cindex < data[controlNames[i]].length; ++cindex) {
					console.log(data[controlNames[i]][cindex], cindex, i);
					dispControlCard(data[controlNames[i]][cindex], cindex, i);
				}
			}
		}
		
		function getText(data){
			authToken = data['authToken'];
			delete data['authToken'];
			
			if(messageId==data['msgId']) {
				return;
			}
			messageId = data['msgId'];
			delete data['msgId'];
			let msg = data['msg'];
			delete data['msg'];
			
			clearControl();
			
			
			
			
			const p = document.createElement("p");
			p.innerHTML = msg;
			p.classList.add("fadein");
			controlTextDiv.appendChild(p);
			
			controlSubmitButton.classList.remove("uninteractable");
			hideOpponentCardButton.classList.remove("uninteractable");
			
			const chooseTextDiv = document.createElement('div');
			chooseTextDiv.id = "chooseText";
			controlDiv.appendChild(chooseTextDiv);
			control.push(chooseTextDiv);
			
			for(let i=0; i<data['msgs'].length; ++i) {
				const ct = new ChooseText(data['msgs'][i], i);
				chooseTextDiv.appendChild(ct.txt);
			}
		}
		
		function updateCollection(data) {
			console.log('in updateCollection', data);
			let cardFunc;
			if(data['operation'] === 'add') {
				cardFunc = dispBGCard;
				if(data['collection']==='response') {
					cardFunc = dispBGCardReverse;
				}
			} else if(data['operation']==='remove'){
				cardFunc = removeBGCard;
				if(data['collection']==='response') {
					cardFunc = removeBGCardReverse;
				}
			}
			
			if(data['collection'] === 'discard') {
				if(data['yours']) {
					for(let card of data['cards']) {
						cardFunc(card, playerDiscard);
					}
				} else {
					for(let card of data['cards']) {
						cardFunc(card, opponentDiscard);
					}
				}
			} else if(data['collection'] === 'hand') {
				if(data['yours']) {
					for(let card of data['cards']) {
						cardFunc(card, playerHand);
					}
				} else {
					for(let card of data['cards']) {
						cardFunc(card, opponentHand);
					}
				}
			} else if(data['collection'] === 'activeGoals') {
				if(data['yours']) {
					for(let card of data['cards']) {
						cardFunc(card, playerActiveGoals);
					}
				} else {
					for(let card of data['cards']) {
						cardFunc(card, opponentActiveGoals);
					}
				}
			} else if(data['collection'] === 'play') {
				if(data['yours']) {
					for(let card of data['cards']) {
						if(data['operation'] === 'remove') {
							card += playerResponseCards;
						}
						console.log("removing: ", card);
						cardFunc(card, playerPlay);
					}
				} else {
					for(let card of data['cards']) {
						if(data['operation'] === 'remove') {
							card += opponentResponseCards;
						}
						cardFunc(card, opponentPlay);
					}
				}
			} else if(data['collection'] === 'response') {
				if(data['yours']) {
					for(let card of data['cards']) {
						if(data['operation'] === 'remove') {
							card += playerResponseCards;
						}
						console.log("adding/removing response card: ", card);
						cardFunc(card, playerPlay);
						playerResponseCards += (data['operation'] === "add") - (data['operation'] === "remove");
					}
				} else {
					for(let card of data['cards']) {
						if(data['operation'] === 'remove') {
							card += opponentResponseCards;
						}
						cardFunc(card, opponentPlay);
						opponentResponseCards += (data['operation'] === "add") - (data['operation'] === "remove");
					}
				}
			}
		}
		
		
		function updateCounters(data) {
			console.log('in updateCounters', data);
			if(data['yours']) {
				if(data['counter'] === 'health') {
					playerHealth.innerHTML = 'health: '+data['amount'];
				} else if(data['counter'] === 'breath') {
					playerBreath.innerHTML = 'breath: '+data['amount'];
				} else if(data['counter'] === 'rp') {
					playerPlay.children[playerResponseCards + data['amount'][0]].children[1].innerHTML = data['amount'][1];
				}
			} else {
				if(data['counter'] === 'health') {
					opponentHealth.innerHTML = 'health: '+data['amount'];
				} else if(data['counter'] === 'breath') {
					opponentBreath.innerHTML = 'breath: '+data['amount'];
				} else if(data['counter'] === 'rp') {
					opponentPlay.children[opponentResponseCards + data['amount'][0]].children[1].innerHTML = data['amount'][1];
				}
			}
		}
		
		
		
		
		function dispCards(data) {
			console.log('in dispCards', data);
			
			
			
			makeNewControlArea(data.msg, opponentCardDiv, opponentCards, opponentCardNames);
			opponentCards[opponentCards.length-1].style.height = 35+"vh";
			opponentCards[opponentCards.length-1].firstChild.style.fontSize = 8+"vh";
			for(let cindex=0; cindex<data.cards.length; ++cindex) {
				dispOpponentCard(data.cards[cindex], cindex, opponentCards.length-1);
			}
		}

		
		
		
		
		
		
		// init values
		cards = {};
		const control = [];
		const controlNames = [];
		const opponentCards = [];
		const opponentCardNames = [];
		let authToken = 0;
		let messageId = 0;
		
		const controlDiv = document.getElementById("control");
		const opponentCardDiv = document.getElementById("opponentCards");
		const controlTextDiv = document.getElementById("controlText");
		const controlSubmitButton = document.getElementById("submitButton");
		const hideOpponentCardButton = document.getElementById("hideOpponentCardButton");
		
		
		const mainDisplayDiv = document.getElementById('mainDisplayDiv');
		
		const counterDiv = document.getElementById("counterDivs");
		const playerHealth = document.getElementById("playerHealth");
		const playerBreath = document.getElementById("playerBreath");
		const opponentHealth = document.getElementById("opponentHealth");
		const opponentBreath = document.getElementById("opponentBreath");
		
		const playerDiscard = document.getElementById('player1');
		const playerDeck = document.getElementById('player2');
		const playerActiveGoals = document.getElementById('player3');
		const playerGoals = document.getElementById('player4');
		const playerHand = document.getElementById('player5');
		const playerPlay = document.getElementById('player6');
		let playerResponseCards = 0;
		
		
		const opponentDiscard = document.getElementById('opponent1');
		const opponentDeck = document.getElementById('opponent2');
		const opponentActiveGoals = document.getElementById('opponent3');
		const opponentGoals = document.getElementById('opponent4');
		const opponentHand = document.getElementById('opponent5');
		const opponentPlay = document.getElementById('opponent6');
		let opponentResponseCards = 0;
		
		
		
		// other stuff
		
		
		
		function makeNewControlArea(name, div, controls, names) {
			const newArea = document.createElement('div');
			newArea.classList.add('subControl');
			//newArea.innerHTML = name;
			
			
			const p = document.createElement('p');
			p.innerHTML = name;
			p.classList.add("label");
			p.classList.add("fadeinthenout");
			
			newArea.appendChild(p);
			
			div.appendChild(newArea);
			controls.push(newArea);
			names.push(name);
			
			
			
			
		}
	
		
		function clearControl() {
			for(let area of control) {
				controlDiv.removeChild(area);
			}
			while(controlTextDiv.firstChild) {
				controlTextDiv.removeChild(controlTextDiv.firstChild);
			}
			control.splice(0,control.length);
			controlNames.splice(0,controlNames.length);
			selected.splice(0,selected.length);
			
			controlSubmitButton.classList.add('uninteractable');
			hideOpponentCardButton.classList.add('uninteractable');
		}
		
		function dispControlCard(cardName, i, section) {
			const c = new GameCard(cardName, i, controlNames[section]);
			c.addTo(control[section]);
		}
		
		function dispOpponentCard(cardName, i, section) {
			const c = new BGCard(cardName);
			c.addTo(opponentCards[section]);
		}
	
		
		
		
		
		
		
		
		
		
		
		
		
		// background stuff
		function dispBGCard(cardName, container) {
			const c = new BGCard(cardName);
			c.addTo(container);
		}
		
		function removeBGCard(i, container) {
			container.removeChild(container.children[i]);
		}
		
		function dispBGCardReverse(cardName, container) {
			const c = new BGCard(cardName);
			c.addToStart(container);
		}
		
		function removeBGCardReverse(i, container) {
			container.removeChild(container.children[container.children.length-i]);
		}
		
		
		
		
		// disp stuff
		mainDisplayDiv.addEventListener('click', function() {
			clearMainDisplay();
		},false);
		
		function clearAndDispCard(cardName, counter) {
			clearMainDisplay();
			dispCard(cardName, counter);
		}
		
		function dispCard(cardName, counter) {
			mainDisplayDiv.classList.add("fadein");
			mainDisplayDiv.style.pointerEvents = "auto";
			const c = new DispCard(cardName, counter);
			c.addTo(mainDisplayDiv);
		}
		
		function dispText(msg) {
			mainDisplayDiv.classList.add("fadein");
			mainDisplayDiv.style.pointerEvents = "auto";
			const p = document.createElement('p');
			p.innerHTML = msg;
			mainDisplayDiv.appendChild(p);
		}
		
		function clearMainDisplay() {
			while(mainDisplayDiv.firstChild) {
				mainDisplayDiv.removeChild(mainDisplayDiv.firstChild);
			}
			mainDisplayDiv.classList.remove("fadein");
			mainDisplayDiv.style.pointerEvents = "none";
		}
		
		
		
		
		
		
		
		
		
		
		// button interaction functions
		function deckreq(){
			socket.emit('reqQueueGame', {name : document.forms['cardForm']['deckName'].value});
			document.getElementById("deckformdiv").style.visibility = "hidden";
			document.getElementById("gamediv").style.visibility = "visible";
		}
		
		function resGetCards() {
			out = [];
			for(let c of selected) {
				out.push([c.category, c.origNumber]);
			}
			socket.emit('clientResChooseCards', {'authToken':authToken, order:out});
			clearControl();
		}
		
		function cycleControl(button) {
			if(opponentCardDiv.style.display === "block") {
				opponentCardDiv.style.display = "none";
				controlDiv.style.display = "block";
				hideOpponentCardButton.innerHTML = "show opponent cards";
			} else {
				opponentCardDiv.style.display = "block";
				controlDiv.style.display = "none";
				hideOpponentCardButton.innerHTML = "hide opponent cards";
			}
		}
		
		function toggleControl(button) {
			console.log(button);
			if(controlDiv.classList.contains('uninteractable')) {
				controlDiv.classList.remove('uninteractable');
				controlTextDiv.classList.remove('uninteractable');
				controlSubmitButton.classList.remove('uninteractable');
				hideOpponentCardButton.classList.remove('uninteractable');
				opponentCardDiv.classList.remove('uninteractable');
				button.innerHTML = 'hide control';
			} else {
				controlDiv.classList.add('uninteractable');
				controlTextDiv.classList.add('uninteractable');
				controlSubmitButton.classList.add('uninteractable');
				hideOpponentCardButton.classList.add('uninteractable');
				opponentCardDiv.classList.add('uninteractable');
				button.innerHTML = 'show control';
			}
			
		}
		
		
		
		
		
		carddisplaysocket.emit("reqAllStockCards", {});
		
	</script>